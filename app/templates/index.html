<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPAM - IP Address Management</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ IPAM - IP Address Management</h1>
            <p class="subtitle">ì„œë¸Œë„· ë° IP ì£¼ì†Œ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
        </header>

        <nav class="tabs">
            <button class="tab-button active" onclick="showTab('subnets')">ì„œë¸Œë„· ëª©ë¡</button>
            <button class="tab-button" onclick="showTab('add-subnet')">ì„œë¸Œë„· ì¶”ê°€</button>
            <button class="tab-button" onclick="showTab('stats')">í†µê³„</button>
        </nav>

        <!-- ì„œë¸Œë„· ëª©ë¡ íƒ­ -->
        <div id="subnets-tab" class="tab-content active">
            <div class="section-header">
                <h2>ì„œë¸Œë„· ëª©ë¡</h2>
                <button class="btn btn-primary" onclick="loadSubnets()">ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <div class="filter-bar">
                <label>
                    <input type="checkbox" id="filter-active" checked onchange="loadSubnets()">
                    í™œì„± ì„œë¸Œë„·ë§Œ í‘œì‹œ
                </label>
            </div>
            <div id="subnets-list" class="subnets-grid">
                <div class="loading">ë¡œë”© ì¤‘...</div>
            </div>
        </div>

        <!-- ì„œë¸Œë„· ì¶”ê°€ íƒ­ -->
        <div id="add-subnet-tab" class="tab-content">
            <div class="section-header">
                <h2>ìƒˆ ì„œë¸Œë„· ì¶”ê°€</h2>
            </div>
            <form id="add-subnet-form" class="form">
                <div class="form-group">
                    <label for="subnet-name">ì„œë¸Œë„· ì´ë¦„ *</label>
                    <input type="text" id="subnet-name" required placeholder="ì˜ˆ: ë³¸ì‚¬ ì„œë²„ë§">
                </div>
                <div class="form-group">
                    <label for="subnet-network">ë„¤íŠ¸ì›Œí¬ (CIDR) *</label>
                    <input type="text" id="subnet-network" required placeholder="ì˜ˆ: 192.168.1.0/24">
                    <small>CIDR í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 192.168.1.0/24)</small>
                </div>
                <div class="form-group">
                    <label for="subnet-description">ì„¤ëª…</label>
                    <textarea id="subnet-description" rows="3" placeholder="ì„œë¸Œë„·ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="subnet-vlan">VLAN ID</label>
                        <input type="number" id="subnet-vlan" placeholder="ì˜ˆ: 100">
                    </div>
                    <div class="form-group">
                        <label for="subnet-location">ìœ„ì¹˜</label>
                        <input type="text" id="subnet-location" placeholder="ì˜ˆ: ë³¸ì‚¬ 3ì¸µ">
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="subnet-active" checked>
                        í™œì„± ìƒíƒœ
                    </label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">ì„œë¸Œë„· ì¶”ê°€</button>
                    <button type="reset" class="btn btn-secondary">ì´ˆê¸°í™”</button>
                </div>
            </form>
        </div>

        <!-- í†µê³„ íƒ­ -->
        <div id="stats-tab" class="tab-content">
            <div class="section-header">
                <h2>í†µê³„ ì •ë³´</h2>
                <button class="btn btn-primary" onclick="loadStats()">ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <div id="stats-content" class="stats-grid">
                <div class="loading">ë¡œë”© ì¤‘...</div>
            </div>
        </div>

        <!-- ë©”ì‹œì§€ ì•Œë¦¼ -->
        <div id="message" class="message"></div>
    </div>

    <script>
        const API_BASE = '/api';

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'subnets') {
                loadSubnets();
            } else if (tabName === 'stats') {
                loadStats();
            }
        }

        // ì„œë¸Œë„· ëª©ë¡ ë¡œë“œ
        async function loadSubnets() {
            const listEl = document.getElementById('subnets-list');
            const filterActive = document.getElementById('filter-active').checked;
            
            listEl.innerHTML = '<div class="loading">ë¡œë”© ì¤‘...</div>';
            
            try {
                const url = filterActive 
                    ? `${API_BASE}/subnets?is_active=true`
                    : `${API_BASE}/subnets`;
                const response = await fetch(url);
                const subnets = await response.json();
                
                if (subnets.length === 0) {
                    listEl.innerHTML = '<div class="empty">ë“±ë¡ëœ ì„œë¸Œë„·ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                listEl.innerHTML = subnets.map(subnet => `
                    <div class="subnet-card">
                        <div class="subnet-header">
                            <h3>${subnet.name}</h3>
                            <span class="badge ${subnet.is_active ? 'badge-success' : 'badge-inactive'}">
                                ${subnet.is_active ? 'í™œì„±' : 'ë¹„í™œì„±'}
                            </span>
                        </div>
                        <div class="subnet-body">
                            <div class="info-row">
                                <strong>ë„¤íŠ¸ì›Œí¬:</strong>
                                <code>${subnet.network}</code>
                            </div>
                            ${subnet.network_info ? `
                                <div class="info-row">
                                    <strong>ì‚¬ìš© ê°€ëŠ¥í•œ í˜¸ìŠ¤íŠ¸:</strong>
                                    <span>${subnet.network_info.usable_hosts}ê°œ</span>
                                </div>
                                <div class="info-row">
                                    <strong>ì„œë¸Œë„· ë§ˆìŠ¤í¬:</strong>
                                    <code>${subnet.network_info.netmask}</code>
                                </div>
                            ` : ''}
                            ${subnet.vlan_id ? `
                                <div class="info-row">
                                    <strong>VLAN ID:</strong>
                                    <span>${subnet.vlan_id}</span>
                                </div>
                            ` : ''}
                            ${subnet.location ? `
                                <div class="info-row">
                                    <strong>ìœ„ì¹˜:</strong>
                                    <span>${subnet.location}</span>
                                </div>
                            ` : ''}
                            ${subnet.description ? `
                                <div class="info-row">
                                    <strong>ì„¤ëª…:</strong>
                                    <span>${subnet.description}</span>
                                </div>
                            ` : ''}
                        </div>
                        <div class="subnet-actions">
                            <button class="btn btn-sm btn-info" onclick="viewSubnetStats(${subnet.id})">í†µê³„ ë³´ê¸°</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteSubnet(${subnet.id}, '${subnet.name}')">ì‚­ì œ</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                listEl.innerHTML = `<div class="error">ì˜¤ë¥˜ ë°œìƒ: ${error.message}</div>`;
            }
        }

        // ì„œë¸Œë„· ì¶”ê°€ í¼ ì œì¶œ
        document.getElementById('add-subnet-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                name: document.getElementById('subnet-name').value,
                network: document.getElementById('subnet-network').value,
                description: document.getElementById('subnet-description').value || null,
                vlan_id: document.getElementById('subnet-vlan').value ? parseInt(document.getElementById('subnet-vlan').value) : null,
                location: document.getElementById('subnet-location').value || null,
                is_active: document.getElementById('subnet-active').checked
            };
            
            try {
                const response = await fetch(`${API_BASE}/subnets`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    showMessage('ì„œë¸Œë„·ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    e.target.reset();
                    showTab('subnets');
                    loadSubnets();
                } else {
                    const error = await response.json();
                    showMessage(`ì˜¤ë¥˜: ${error.detail}`, 'error');
                }
            } catch (error) {
                showMessage(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
            }
        });

        // ì„œë¸Œë„· ì‚­ì œ
        async function deleteSubnet(id, name) {
            if (!confirm(`ì„œë¸Œë„· "${name}"ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/subnets/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showMessage('ì„œë¸Œë„·ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadSubnets();
                } else {
                    const error = await response.json();
                    showMessage(`ì˜¤ë¥˜: ${error.detail}`, 'error');
                }
            } catch (error) {
                showMessage(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
            }
        }

        // ì„œë¸Œë„· í†µê³„ ë³´ê¸°
        async function viewSubnetStats(id) {
            try {
                const response = await fetch(`${API_BASE}/subnets/${id}/stats`);
                const stats = await response.json();
                
                alert(`ì„œë¸Œë„· í†µê³„\n\n` +
                      `ë„¤íŠ¸ì›Œí¬: ${stats.network}\n` +
                      `ì „ì²´ í˜¸ìŠ¤íŠ¸: ${stats.network_info.usable_hosts}ê°œ\n` +
                      `í• ë‹¹ëœ IP: ${stats.allocated_ips}ê°œ\n` +
                      `ì‚¬ìš© ê°€ëŠ¥í•œ IP: ${stats.available_ips}ê°œ\n` +
                      `ì‚¬ìš©ë¥ : ${stats.utilization_percent}%`);
            } catch (error) {
                showMessage(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
            }
        }

        // í†µê³„ ë¡œë“œ
        async function loadStats() {
            const statsEl = document.getElementById('stats-content');
            statsEl.innerHTML = '<div class="loading">ë¡œë”© ì¤‘...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/subnets`);
                const subnets = await response.json();
                
                let totalSubnets = subnets.length;
                let activeSubnets = subnets.filter(s => s.is_active).length;
                let totalHosts = 0;
                
                subnets.forEach(subnet => {
                    if (subnet.network_info) {
                        totalHosts += subnet.network_info.usable_hosts;
                    }
                });
                
                statsEl.innerHTML = `
                    <div class="stat-card">
                        <h3>ì „ì²´ ì„œë¸Œë„·</h3>
                        <div class="stat-value">${totalSubnets}</div>
                    </div>
                    <div class="stat-card">
                        <h3>í™œì„± ì„œë¸Œë„·</h3>
                        <div class="stat-value">${activeSubnets}</div>
                    </div>
                    <div class="stat-card">
                        <h3>ì „ì²´ ì‚¬ìš© ê°€ëŠ¥í•œ í˜¸ìŠ¤íŠ¸</h3>
                        <div class="stat-value">${totalHosts.toLocaleString()}</div>
                    </div>
                `;
            } catch (error) {
                statsEl.innerHTML = `<div class="error">ì˜¤ë¥˜ ë°œìƒ: ${error.message}</div>`;
            }
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(text, type = 'info') {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message message-${type}`;
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 3000);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë¸Œë„· ëª©ë¡ ìë™ ë¡œë“œ
        window.addEventListener('DOMContentLoaded', () => {
            loadSubnets();
        });
    </script>
</body>
</html>


